# =============================================================================
# ORIGINAL CONFIG (commented out for testing README instructions)
# =============================================================================
# name: Validate Tags
#
# on:
#   pull_request:
#     paths:
#       - 'environments/**/*.tf'
#
# permissions:
#   contents: read
#   pull-requests: write
#
# jobs:
#   checkov-validate:
#     name: Checkov Tag Validation
#     runs-on: ubuntu-latest
#     steps:
#       - uses: actions/checkout@v4
#
#       - uses: FolarinOyenuga/checkov-tag-validator@v1
#         id: checkov
#         with:
#           terraform_directory: ./environments/tag-test-dev
#           required_tags: |
#             business-unit
#             application
#             owner
#             is-production
#             service-area
#             environment
#           soft_fail: false
#
#       - name: Post Checkov Results
#         if: always() && github.event_name == 'pull_request'
#         uses: actions/github-script@v7
#         env:
#           SUMMARY: ${{ steps.checkov.outputs.violations_summary }}
#           PASSED: ${{ steps.checkov.outputs.passed }}
#         with:
#           script: |
#             const summary = process.env.SUMMARY || '‚úÖ All resources have required tags';
#             const passed = process.env.PASSED === 'true';
#             const icon = passed ? '‚úÖ' : '‚ö†Ô∏è';
#             github.rest.issues.createComment({
#               issue_number: context.issue.number,
#               owner: context.repo.owner,
#               repo: context.repo.repo,
#               body: `## üè∑Ô∏è Checkov Tag Validation ${icon}\n\n${summary}`
#             });
#
#   opa-validate:
#     ...
#
#   ttv-validate:
#     ...
# =============================================================================

# =============================================================================
# EXACT README INSTRUCTIONS (only terraform_directory changed for playground)
# =============================================================================
name: Validate Tags

on:
  pull_request:
    paths:
      - '**/*.tf'

permissions:
  contents: read
  pull-requests: write

jobs:
  validate-tags:
    name: Tag Validation
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Validate Tags
        id: validate
        uses: FolarinOyenuga/checkov-tag-validator@v1
        with:
          terraform_directory: ./environments/tag-test-dev
          required_tags: |
            business-unit
            application
            owner
            is-production
            service-area
            environment
          soft_fail: false

      - name: Post Results to PR
        if: always() && github.event_name == 'pull_request'
        uses: actions/github-script@v7
        env:
          SUMMARY: ${{ steps.validate.outputs.violations_summary }}
          PASSED: ${{ steps.validate.outputs.passed }}
        with:
          script: |
            const summary = process.env.SUMMARY || '‚úÖ All resources have required tags';
            const passed = process.env.PASSED === 'true';
            const icon = passed ? '‚úÖ' : '‚ö†Ô∏è';
            github.rest.issues.createComment({
              issue_number: context.issue.number,
              owner: context.repo.owner,
              repo: context.repo.repo,
              body: `## üè∑Ô∏è Tag Validation ${icon}\n\n${summary}`
            });
